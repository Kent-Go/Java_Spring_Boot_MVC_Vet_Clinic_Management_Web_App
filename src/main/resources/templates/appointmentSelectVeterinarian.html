<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>New Appointment Scheduling</title>
    <link rel="stylesheet" href="/css/vetList.css">
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const vetCards = document.querySelectorAll('.vet-card');
            const urlParams = new URLSearchParams(window.location.search);
            const petId = urlParams.get('petId');
            const petName = urlParams.get('petName');
            const appointmentTypeId = urlParams.get('appointmentTypeId');
            const appointmentTypeName = urlParams.get('appointmentTypeName');

            // Make the entire card clickable
            vetCards.forEach(card => {
                card.addEventListener('click', function () {
                    // Remove the 'selected' class from all cards
                    vetCards.forEach(c => c.classList.remove('selected'));

                    // Add 'selected' class to the clicked card
                    card.classList.add('selected');
                });
            });

            // Continue button logic
            document.querySelector('.continue-button').addEventListener('click', function () {
                const selectedCard = document.querySelector('.vet-card.selected');
                if (selectedCard) {
                    const selectedVetId = selectedCard.getAttribute('data-vet-id');

                    localStorage.setItem('selectedVetId', selectedVetId)

                    // Redirect to the vetSchedule page with the selected vet ID
                    window.location.href = `/appointment/time?vetId=${vetId}&vetName=${encodeURIComponent(vetName)}&appointmentTypeId=${appointmentTypeId}&appointmentTypeName=${encodeURIComponent(appointmentTypeName)}&petId=${petId}&petName=${encodeURIComponent(petName)}`;
                } else {
                    alert('Please select a veterinarian to continue.');
                }
            });

            // Back button logic
            document.querySelector('.back-button').addEventListener('click', function () {
                // Redirect back to the appointment type selection page
                window.location.href = `/appointment/new/select_appointment_type`;
            });
        });
    </script>
</head>
<body>

<div class="header">
    <a href="/">
        <img src="/images/logo.png" alt="Logo">
    </a>
    <a href="login" class="profile-link">
        <img src="/images/profile.png" alt="Profile" class="profile-icon">
    </a>
</div>

<div class="container">
    <h1>New Appointment Scheduling</h1>
    <h3>Select a Veterinarian:</h3>

    <div th:each="vetAppointmentTypeOffered : ${vetAppointmentTypeOffereds}" class="vet-card" th:data-vet-id="${vetAppointmentTypeOffered.vet.id}">
        <h3 th:text="${vetAppointmentTypeOffered.vet.title + ' ' + vetAppointmentTypeOffered.vet.user.firstName + ' ' + vetAppointmentTypeOffered.vet.user.lastName}"></h3>
        <p th:text="${vetAppointmentTypeOffered.vet.languagesSpoken}"></p>
        <p th:text="${vetAppointmentTypeOffered.vet.selfDescription}"></p>
    </div>
</div>

<div class="buttons">
    <button type="button" class="back-button">Back</button>
    <button type="button" class="continue-button">Continue</button>
</div>

</body>
</html>
