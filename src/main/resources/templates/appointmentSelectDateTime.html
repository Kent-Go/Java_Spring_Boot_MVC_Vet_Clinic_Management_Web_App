<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>New Appointment Scheduling</title>
    <link rel="stylesheet" href="/css/newAppointment.css">
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const timeSlots = document.querySelectorAll('.time-slot');
            const urlParams = new URLSearchParams(window.location.search);
            const petId = urlParams.get('petId');
            const petName = urlParams.get('petName');
            const appointmentTypeId = urlParams.get('appointmentTypeId');
            const appointmentTypeName = urlParams.get('appointmentTypeName');
            const vetId = urlParams.get('vetId');
            const vetName = urlParams.get('vetName');

            timeSlots.forEach(slot => {
                slot.addEventListener('click', function () {
                    // Remove 'selected' class from all time slots
                    timeSlots.forEach(s => s.classList.remove('selected'));

                    // Add 'selected' class to the clicked time slot
                    slot.classList.add('selected');
                });
            });

            // continue button logic
            document.querySelector('.continue-button').addEventListener('click', function () {
                const selectedSlot = document.querySelector('.time-slot.selected');
                const selectedDate = document.querySelector('#appointment-date').value; // Get the date

                if (!selectedDate) {
                    alert('Please select a date.');
                    return;
                }

                if (selectedSlot) {
                    const selectedTime = selectedSlot.getAttribute('data-time');
                    // Redirect or perform action with selected time and date
                    window.location.href = `/appointment/confirm?petId=${petId}&petName=${encodeURIComponent(petName)}&appointmentTypeId=${appointmentTypeId}&appointmentTypeName=${encodeURIComponent(appointmentTypeName)}&vetId=${vetId}&vetName=${encodeURIComponent(vetName)}&time=${selectedTime}&date=${selectedDate}`;
                } else {
                    alert('Please select a time to continue.');
                }
            });

            // back button logic
            document.querySelector('.back-button').addEventListener('click', function () {
                window.history.back(); // Go back to the previous page
            });
        });

        function handleDateChange() {
            const selectedVetId = localStorage.getItem('selectedVetId');
            var dateValue = document.getElementById("appointment-date").value;
            console.log("Selected date: " + dateValue);
            // You can perform any action with the dateValue here
            document.getElementById("selected-date").innerText = "Selected date: " + dateValue;

            // Fetch appointment details based on userId through the API
            fetch(`/api/appointment/${selectedVetId}?date=${dateValue}`)
                .then((response) => response.json())
                .then((data) => {
                    const scheduledTime = {};
                    data.forEach((appointment) => {
                        scheduledTime[appointment.startTime] = appointment.endTime;
                    });
                    console.log(scheduledTime);
                    // You can now use dateDictionary as needed
                })
                .catch((error) => {
                    console.error('Error fetching appointments:', error);
                });
        }
    </script>

</head>
<body>

<div class="header">
    <a href="/">
        <img src="/images/logo.png" alt="Logo" class="logo">
    </a>
    <a href="login" class="profile-link">
        <img src="/images/profile.png" alt="Profile" class="profile-icon">
    </a>
</div>

<div class="container">
    <h1>New Appointment Scheduling</h1>
    <h3>Select Date and Time:</h3>

    <!-- Date Picker (For the sake of simplicity, using a simple date input) -->
    <input type="date" id="appointment-date" name="appointment-date" value="2024-09-29" onchange="handleDateChange()">
    <p id="selected-date">Selected date: 2024-09-29</p>
    

    <h3>Time Available:</h3>

    <div class="time-container">
        <div class="time-slot" data-time="9:00 AM">9:00 AM</div>
        <div class="time-slot" data-time="11:00 AM">11:00 AM</div>
        <div class="time-slot" data-time="11:30 AM">11:30 AM</div>
        <div class="time-slot" data-time="2:00 PM">2:00 PM</div>
        <div class="time-slot" data-time="3:00 PM">3:00 PM</div>
        <div class="time-slot" data-time="4:00 PM">4:00 PM</div>
        <div class="time-slot" data-time="5:00 PM">5:00 PM</div>
        <div class="time-slot" data-time="6:00 PM">6:00 PM</div>
    </div>

    <div class="buttons">
        <button type="button" class="back-button">Back</button>
        <button type="button" class="continue-button">Continue</button>
    </div>
</div>

</body>
</html>
