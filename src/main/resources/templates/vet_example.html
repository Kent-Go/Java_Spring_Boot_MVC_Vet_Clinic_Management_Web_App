<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Vet Example</title>

    <script>
        async function fetchAllVets() {
            const response = await fetch('/vets');
            if (response.ok) {
                const vets = await response.json();
                console.log(vets);
                displayVets(vets);
            } else {
                alert('Error retrieving vets.');
            }
        }

        function displayVets(vets) {
            const vetsList = document.getElementById('vetsList');
            vetsList.innerHTML = '';
            vets.forEach(vet => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    ID: ${vet.id} - 
                    Title: ${vet.title} - 
                    Languages Spoken: ${vet.languagesSpoken} - 
                    Self Description: ${vet.selfDescription} - 
                    UserID: ${vet.userID} - 
                    <img src="data:image/jpeg;base64,${vet.profilePicture}" alt="Profile Picture"/>
                `;
                vetsList.appendChild(listItem);
            });
        }

        
        async function submitVetByUserIDForm(event) {
            event.preventDefault();
            const userID = document.getElementById('VetByUserID').value;

            const response = await fetch(`/vets/${userID}`, {
                method: 'GET'
            });

            if (response.ok) {
                const vet = await response.json();
                alert(`Vet found: ${vet.title}, ${vet.languagesSpoken}, ${vet.selfDescription}, ${vet.userID}`);
                // You can update the page with the vet details here
            } else {
                alert('Error retrieving vet.');
            }
        }
        
        async function submitAddVetForm(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
    
            const response = await fetch('/vets/new', {
                method: 'POST',
                body: formData
            });
    
            if (response.ok) {
                alert('Vet added successfully!');
                window.location.href = '/vet_example';
            } else {
                alert('Error adding vet.');
            }
        }
        window.onload = fetchAllVets();
    </script>

</head>
<body>
    <h2>Vets List:</h2>
        <ul id="vetsList">
            <!-- Vets will be displayed here -->
        </ul>

    <h2>Retrieve Vet using UserID</h2>
    <form onsubmit="submitVetByUserIDForm(event)">
        <label for="title">UserID:</label>
        <input type="text" id="VetByUserID" name="VetByUserID" required><br>

        <button type="submit">Retrieve Vet</button>
    </form>

    <h2>Add New Vet</h2>
    <form onsubmit="submitAddVetForm(event)">
        <label for="title">Title:</label>
        <input type="text" id="title" name="title" required><br>

        <label for="languagesSpoken">Languages Spoken:</label>
        <input type="text" id="languagesSpoken" name="languagesSpoken" required><br>

        <label for="selfDescription">Self Description:</label>
        <textarea id="selfDescription" name="selfDescription" required></textarea><br>

        <!-- <label for="profilePicture">Profile Picture:</label>
        <input type="file" id="profilePicture" name="profilePicture" required><br> -->

        <label for="userID">User ID:</label>
        <input type="number" id="userID" name="userID" required><br>

        <button type="submit">Add Vet</button>
    </form>
</body>
</html>
